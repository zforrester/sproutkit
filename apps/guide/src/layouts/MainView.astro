---
import Body from '../layouts/Body.astro'
import Nav from '../components/Nav.astro'

export interface Props {
  title: string
}

const { frontmatter, headings } = Astro.props
---

<Body title={frontmatter.title}>
  <a class='skip-to-content-anchor' href='#main-content'>Skip to main content</a>
  <nav class='main-nav'>
    <Nav />
  </nav>
  <main>
    <header>
      <h1>{frontmatter.title}</h1>
    </header>
    <article id='main-content'>
      <slot />
    </article>
    {
      headings?.length > 0 ? (
        <aside>
          <h4>On This Page</h4>
          <nav class='headings'>
            <ul>
              {headings.map((heading: any) =>
                heading.depth > 1 ? (
                  <li>
                    <a href={`#${heading.slug}`}>{heading.text}</a>
                  </li>
                ) : null
              )}
            </ul>
          </nav>
        </aside>
      ) : null
    }
  </main>
</Body>

<style is:global lang='scss'>
  html {
    display: flex;
    // @include debug;
    min-height: 100%;
    max-width: 100vw;

    line-height: line-height('small');
  }

  body {
    display: flex;
    flex-grow: 1;
    max-width: 100vw;
    min-width: 0;
    max-height: 100vh;
    overflow: hidden;
    // @include debug;
    font-family: font-family('primary');
    color: color('red-500');
  }

  main {
    flex-grow: 1;
    display: flex;
    min-width: 0;
    flex-shrink: 1;
    flex-wrap: wrap;
    padding: clamp(space(2), 5vw, space(10));

    // @include debug;
    overflow-y: auto;
    overflow-x: hidden;
  }

  header {
    margin: clamp(space(2), 5vw, space(10));
    padding-bottom: space(5);
    width: 100%;
    box-shadow: 0 1px 0 color('gray-500', 0.2);
    h1 {
      @include font(56, 'bold');
      color: color('gray-800');
    }
  }

  article {
    flex-grow: 1;
    width: 80%;
    flex-shrink: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    color: color('gray-700');
    padding: 0 clamp(space(2), 5vw, space(10));
    @include font(14, 'normal');

    h1,
    h2,
    h3 {
      color: color('gray-800');
    }

    h1 {
      @include font(48, 'bold');
    }
    h2 {
      @include font(32, 'bold');
    }

    p {
      margin: space(2) 0;
    }
    * + h2 {
      margin-top: space(2);
    }
  }

  pre {
    width: 100%;
    overflow: auto;
    min-width: 0;
    background-color: color('gray-800');
    padding: space(2) space(3);
    border-radius: radius(1);
    color: color('gray-200');
    line-height: 2;
    position: relative;
    margin: space(2) 0;

    p + & {
      margin-top: 0;
    }

    &::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, color('gray-800', 0), color('gray-800'));
      width: space(5);
    }
  }

  code {
  }

  nav {
    flex-shrink: 0;
    width: clamp(240px, 20vw, 320px);
    position: sticky;
    top: 0;

    &.main-nav {
      overflow: auto;
      background-color: color('gray-100');
      padding: clamp(space(2), 2vw, space(6));
      flex-grow: 1;
    }
  }

  aside {
    width: 20%;
    min-width: 120px;
    flex-grow: 1;
    flex-shrink: 0;
    height: 100%;
    position: sticky;
    top: 0;

    h4 {
      @include font(14, 'bold');
      @include font(12, 'semi-bold');
      color: color('gray-800');
      padding: space(0.5);
    }
    .headings {
      ul,
      li {
        margin: 0;
        padding: 0;
        list-style: none;
      }
      section {
        margin: 0;
        padding: space(2);
      }
      h2 {
        @include font(12, 'semi-bold');
        color: color('gray-800');
        padding: space(0.5);
        background-color: white;
        position: sticky;
        top: 0;
      }

      li {
        padding: space(0.5);
      }

      a {
        @include font(14, 'medium');
        text-decoration: none;
        color: color('gray-600');
        padding: space(0.5) space(1.5);
      }
    }
  }

  .skip-to-content-anchor {
    position: absolute;
    top: 0;
    left: 0;
    @include transition;
    transform: translate3d(0, -100%, 0);
  }
</style>
